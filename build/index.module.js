function t(e){this.rgb=[],this.hex=[],this.hsl=[];var r=null;if(Array.isArray(e))this.rgb=e;else if(/^\D*(\d{1,3})[^°\d]+(\d{1,3})[^%\d]+(\d{1,3})\D*$/.test(e)){for(var i=0;i<3;i++)if(this.rgb[i]=RegExp["$"+(i+1)]-0,this.rgb[i]>255){this.rgb=[];break}}else if(r=/^\s*#?([0-9a-f]{3}([0-9a-f]{3})?)\s*$/i.exec(e)){var n,o=r[1],s=o.length/3;for(i=0;i<o.length;i+=s){var h=o.substr(i,s);1==s&&(h+=h),n=i/s,this.hex[n]=h,this.rgb[n]=parseInt(h,16)}}else if(/^\D*(\d+)\D+(\d+(\.\d+)?)%\D+(\d+(\.\d+)?)%\D*$/.test(e)){var a=RegExp.$1-0,u=RegExp.$2-0,c=RegExp.$4-0;if(a<=360&&u<=100&&c<=100)if(this.hsl=[a,u,c],a/=360,c/=100,0==(u/=100)){var l=g=b=Math.ceil(255*c);this.rgb=[l,g,b]}else{var f=c>=.5?c+u-c*u:c*(1+u),p=2*c-f,v=[1/3,0,-1/3];for(i=0;i<3;i++){var m=a+v[i];m<0&&(m+=1),m>1&&(m-=1),m=6*m<1?p+6*(f-p)*m:2*m<1?f:3*m<2?p+(f-p)*(2/3-m)*6:p,v[i]=Math.ceil(255*m)}this.rgb=v}}t.prototype.toString=function(t){var e="";switch(t&&(t=t.toLowerCase()),t){case"hex":if(3!=this.hex.length&&3==this.rgb.length)for(var r=0;r<this.rgb.length;r++){var i=this.rgb[r].toString(16);1==i.length&&(i="0"+i),this.hex[r]=i}3==this.hex.length&&(e="#"+this.hex[0]+this.hex[1]+this.hex[2]);break;case"hsl":if(3!=this.hsl.length&&3==this.rgb.length){var n,o,s,h=this.rgb[0]/255,a=this.rgb[1]/255,u=this.rgb[2]/255,c=Math.max(h,a,u),l=Math.min(h,a,u);s=(c+l)/2;var g=c-l;n=0==(o=0==g?0:g/(1-Math.abs(2*s-1)))?0:h==c?(a-u)/g%6:a==c?(u-h)/g+2:(h-a)/g+4,(n*=60)<0&&(n+=360),this.hsl=[Math.round(n),(100*o).toFixed(1),(100*s).toFixed(1)]}3==this.hsl.length&&(e="hsl("+this.hsl[0]+"°, "+this.hsl[1]+"%, "+this.hsl[2]+"%)");break;case"rgb":default:3==this.rgb.length&&(e="rgb("+this.rgb[0]+", "+this.rgb[1]+", "+this.rgb[2]+")")}return e}}
/*
 * Color Thief v2.0
 * by Lokesh Dhakar - http://www.lokeshdhakar.com
 *
 * Thanks
 * ------
 * Nick Rabinowitz - For creating quantize.js.
 * John Schulz - For clean up and optimization. @JFSIII
 * Nathan Spady - For adding drag and drop support to the demo page.
 *
 * License
 * -------
 * Copyright 2011, 2015 Lokesh Dhakar
 * Released under the MIT license
 * https://raw.githubusercontent.com/lokesh/color-thief/master/LICENSE
 *
 * @license
 */var e=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.style.display="none",document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width||t.offsetWidth,this.height=this.canvas.height=t.height||t.offsetHeight,this.context.drawImage(t,0,0,this.width,this.height)};e.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},e.prototype.update=function(t){this.context.putImageData(t,0,0)},e.prototype.getPixelCount=function(){return this.width*this.height},e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},e.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var r=function(){};
/*!
 * quantize.js Copyright 2008 Nick Rabinowitz.
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 * @license
 */
/*!
 * Block below copied from Protovis: http://mbostock.github.com/protovis/
 * Copyright 2010 Stanford Visualization Group
 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
 * @license
 */
if(r.prototype.getColor=function(t,e){var r=this.getPalette(t,5,e);return r&&r[0]},r.prototype.getPalette=function(t,r,i){(void 0===r||r<2||r>256)&&(r=10),(void 0===i||i<1)&&(i=10);var o=new e(t),s=null;try{s=o.getImageData()}catch(t){return o.removeCanvas(),null}for(var h,a,u,c,l=s.data,g=o.getPixelCount(),f=[],p=0;p<g;p+=i)a=l[(h=4*p)+0],u=l[h+1],c=l[h+2],l[h+3]>=125&&(a>250&&u>250&&c>250||f.push([a,u,c]));var v=n.quantize(f,r),b=v?v.palette():null;return o.removeCanvas(),b},r.prototype.getColorFromUrl=function(t,e,r){sourceImage=document.createElement("img");var i=this;sourceImage.addEventListener("load",function(){var n=i.getPalette(sourceImage,5,r)[0];e(n,t)}),sourceImage.src=t},r.prototype.getImageData=function(t,e){xhr=new XMLHttpRequest,xhr.open("GET",t,!0),xhr.responseType="arraybuffer",xhr.onload=function(t){if(200==this.status){uInt8Array=new Uint8Array(this.response),r=uInt8Array.length,binaryString=new Array(r);for(var r=0;r<uInt8Array.length;r++)binaryString[r]=String.fromCharCode(uInt8Array[r]);data=binaryString.join(""),base64=window.btoa(data),e("data:image/png;base64,"+base64)}},xhr.send()},r.prototype.getColorAsync=function(t,e,r){var i=this;this.getImageData(t,function(t){sourceImage=document.createElement("img"),sourceImage.addEventListener("load",function(){var t=i.getPalette(sourceImage,5,r)[0];e(t,this)}),sourceImage.src=t})},!i)var i={map:function(t,e){var r={};return e?t.map(function(t,i){return r.index=i,e.call(r,t)}):t.slice()},naturalOrder:function(t,e){return t<e?-1:t>e?1:0},sum:function(t,e){var r={};return t.reduce(e?function(t,i,n){return r.index=n,t+e.call(r,i)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?i.map(t,e):t)}};var n=function(){var t=5,e=8-t,r=1e3,n=.75;function o(e,r,i){return(e<<2*t)+(r<<t)+i}function s(t){var e=[],r=!1;function i(){e.sort(t),r=!0}return{push:function(t){e.push(t),r=!1},peek:function(t){return r||i(),void 0===t&&(t=e.length-1),e[t]},pop:function(){return r||i(),e.pop()},size:function(){return e.length},map:function(t){return e.map(t)},debug:function(){return r||i(),e}}}function h(t,e,r,i,n,o,s){this.r1=t,this.r2=e,this.g1=r,this.g2=i,this.b1=n,this.b2=o,this.histo=s}function a(){this.vboxes=new s(function(t,e){return i.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function u(t,e){if(e.count()){var r=e.r2-e.r1+1,n=e.g2-e.g1+1,s=e.b2-e.b1+1,h=i.max([r,n,s]);if(1==e.count())return[e.copy()];var a,u,c,l,g=0,f=[],p=[];if(h==r)for(a=e.r1;a<=e.r2;a++){for(l=0,u=e.g1;u<=e.g2;u++)for(c=e.b1;c<=e.b2;c++)l+=t[o(a,u,c)]||0;g+=l,f[a]=g}else if(h==n)for(a=e.g1;a<=e.g2;a++){for(l=0,u=e.r1;u<=e.r2;u++)for(c=e.b1;c<=e.b2;c++)l+=t[o(u,a,c)]||0;g+=l,f[a]=g}else for(a=e.b1;a<=e.b2;a++){for(l=0,u=e.r1;u<=e.r2;u++)for(c=e.g1;c<=e.g2;c++)l+=t[o(u,c,a)]||0;g+=l,f[a]=g}return f.forEach(function(t,e){p[e]=g-t}),v(h==r?"r":h==n?"g":"b")}function v(t){var r,i,n,o,s,h=t+"1",u=t+"2",c=0;for(a=e[h];a<=e[u];a++)if(f[a]>g/2){for(n=e.copy(),o=e.copy(),s=(r=a-e[h])<=(i=e[u]-a)?Math.min(e[u]-1,~~(a+i/2)):Math.max(e[h],~~(a-1-r/2));!f[s];)s++;for(c=p[s];!c&&f[s-1];)c=p[--s];return n[u]=s,o[h]=n[u]+1,[n,o]}}}return h.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var e=this.histo;if(!this._count_set||t){var r,i,n,s=0;for(r=this.r1;r<=this.r2;r++)for(i=this.g1;i<=this.g2;i++)for(n=this.b1;n<=this.b2;n++)s+=e[o(r,i,n)]||0;this._count=s,this._count_set=!0}return this._count},copy:function(){return new h(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(e){var r=this.histo;if(!this._avg||e){var i,n,s,h,a=0,u=1<<8-t,c=0,l=0,g=0;for(n=this.r1;n<=this.r2;n++)for(s=this.g1;s<=this.g2;s++)for(h=this.b1;h<=this.b2;h++)a+=i=r[o(n,s,h)]||0,c+=i*(n+.5)*u,l+=i*(s+.5)*u,g+=i*(h+.5)*u;this._avg=a?[~~(c/a),~~(l/a),~~(g/a)]:[~~(u*(this.r1+this.r2+1)/2),~~(u*(this.g1+this.g2+1)/2),~~(u*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>e,i=t[1]>>e,n=t[2]>>e;return r>=this.r1&&r<=this.r2&&i>=this.g1&&i<=this.g2&&n>=this.b1&&n<=this.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,r=0;r<e.size();r++)if(e.peek(r).vbox.contains(t))return e.peek(r).color;return this.nearest(t)},nearest:function(t){for(var e,r,i,n=this.vboxes,o=0;o<n.size();o++)((r=Math.sqrt(Math.pow(t[0]-n.peek(o).color[0],2)+Math.pow(t[1]-n.peek(o).color[1],2)+Math.pow(t[2]-n.peek(o).color[2],2)))<e||void 0===e)&&(e=r,i=n.peek(o).color);return i},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return i.naturalOrder(i.sum(t.color),i.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var r=t.length-1,n=t[r].color;n[0]>251&&n[1]>251&&n[2]>251&&(t[r].color=[255,255,255])}},{quantize:function(c,l){if(!c.length||l<2||l>256)return!1;var g=function(r){var i,n,s,h,a=new Array(1<<3*t);return r.forEach(function(t){n=t[0]>>e,s=t[1]>>e,h=t[2]>>e,i=o(n,s,h),a[i]=(a[i]||0)+1}),a}(c);g.forEach(function(){});var f=function(t,r){var i,n,o,s=1e6,a=0,u=1e6,c=0,l=1e6,g=0;return t.forEach(function(t){i=t[0]>>e,n=t[1]>>e,o=t[2]>>e,i<s?s=i:i>a&&(a=i),n<u?u=n:n>c&&(c=n),o<l?l=o:o>g&&(g=o)}),new h(s,a,u,c,l,g,r)}(c,g),p=new s(function(t,e){return i.naturalOrder(t.count(),e.count())});function v(t,e){for(var i,n=1,o=0;o<r;)if((i=t.pop()).count()){var s=u(g,i),h=s[0],a=s[1];if(!h)return;if(t.push(h),a&&(t.push(a),n++),n>=e)return;if(o++>r)return}else t.push(i),o++}p.push(f),v(p,n*l);for(var b=new s(function(t,e){return i.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});p.size();)b.push(p.pop());v(b,l-b.size());for(var m=new a;b.size();)m.push(b.pop());return m}}}();
/*
 * @name: color-change
 * @description: Change the color element in the page, including image, video, canvas
 * @author: 朱润亚 zhu18@vip.qq.com (https://github.com/zhu18)
 * @license: MIT License
 * */class o{constructor(t){this.img=t,this._parser=new r}getColor(){return this._parser.getColor(this.img)}getColors(t=5){return this._parser.getPalette(this.img,t).slice(0,t)}}const s="__anov_colorChange_tag";class h{constructor(t,e=!1,r=!1){this.el="string"==typeof t?document.querySelectorAll(t):t,this.el=this.el||document.body,this.isSaturate=r,this.isBright=e}setColor(e){let r=new t(e);r.toString("hsl"),this.el instanceof NodeList?Array.from(this.el).map(t=>{this._applyColor(t,r)}):this._applyColor(this.el,r)}clear(){this.el instanceof NodeList?Array.from(this.el).map(t=>{this._clearColor(t)}):this._clearColor(el)}_clearColor(t){t.hasAttribute(s)&&(t.style.filter="",t.removeAttribute(s))}async _applyColor(e,r){let i=await this._getImageByElement(e);if(!i)return;let n=new t(new o(i).getColor());n.toString("hsl");let h=" hue-rotate("+(r.hsl[0]-n.hsl[0])+"deg)",a=this.isSaturate?" saturate("+(.01*r.hsl[1]).toFixed(1)+")":"",u=this.isBright?" brightness("+(.02*r.hsl[2]).toFixed(1)+")":"";e.style.filter=h+a+u,e.setAttribute(s,"")}_getImageByElement(t){return new Promise((e,r)=>{if("IMG"===t.tagName||"VIDEO"===t.tagName||"CANVAS"===t.tagName)e(t);else if(t.style.background){let r=document.createElement("IMG");r.src=t.style.background.split("(")[1].split(")")[0].replaceAll('"',""),r.onload=(()=>{e(r)})}else e(null)})}}export{t as Color,h as ColorChange,o as ColorPick};
